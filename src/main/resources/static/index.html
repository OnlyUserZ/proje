<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Auth Page</title>
</head>
<body>

<h2>LOGIN</h2>
<input id="loginUsername" placeholder="Username">
<input id="loginPassword" type="password" placeholder="Password">
<button onclick="login()">Login</button>

<hr>

<h2>REGISTER</h2>
<input id="regUsername" placeholder="Username">
<input id="regPassword" type="password" placeholder="Password">
<button onclick="register()">Register</button>

<hr>

<h2>CHANGE PASSWORD</h2>
<input id="oldPassword" type="password" placeholder="Old Password">
<input id="newPassword" type="password" placeholder="New Password">
<button onclick="changePassword()">Change Password</button>

<hr>

<h2>LOGOUT</h2>
<button onclick="logout()">Logout</button>

<script>
    const API = "http://localhost:8080/auth";

    function login() {
        fetch(API + "/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                username: document.getElementById("loginUsername").value,
                password: document.getElementById("loginPassword").value
            })
        })
        .then(r => r.json())
        .then(data => {
            localStorage.setItem("accessToken", data.accessToken);
            localStorage.setItem("refreshToken", data.refreshToken);
            alert("Login başarılı");
        });
    }

    function register() {
        fetch(API + "/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                username: document.getElementById("regUsername").value,
                password: document.getElementById("regPassword").value
            })
        })
        .then(() => alert("Kayıt başarılı"));
    }

    function changePassword() {
        fetch(API + "/change-password", {
            method: "PUT",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + localStorage.getItem("accessToken")
            },
            body: JSON.stringify({
                oldPassword: document.getElementById("oldPassword").value,
                newPassword: document.getElementById("newPassword").value
            })
        })
        .then(() => alert("Şifre değişti"));
    }

    function logout() {
        fetch(API + "/logout", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                refreshToken: localStorage.getItem("refreshToken")
            })
        })
        .then(() => {
            localStorage.clear();
            alert("Çıkış yapıldı");
        });
    }
</script>

</body>
</html>
